
name: VCollabPro_CI
on:
 push:
   paths:
     - .github/workflows/main.yml
    
 workflow_dispatch:
jobs:
 build:
    runs-on: windows-latest
    env: 
       VMCAD_DEP: "VMCAD_DEP\\VMoveCAD_DEPS"
       #PATH: VCDEP\VMoveCAD_DEPS\DATAKIT\2023.2\Lib_include
   
    steps:
      - uses: actions/checkout@v2.3.4
      
      - uses: suisei-cn/actions-download-file@v1.0.1
        id: download_file  # Remember to give an ID if you need the output filename
        name: Download the file from url
        with:
          url: "https://downloads.vcollab.com/VCollab_Build_CI/VMoveCAD/VMoveCAD_DEPS.7z"
          target: VMCAD_DEP\
          
      - name: Checkout repository
        uses: actions/checkout@v2
      
      - name: Extract Dependencies
        run: |
           unzip ${{ env.VMCAD_DEP }}/VMoveCAD_DEPS.7z -d VMCAD_DEP
            
      - name: Setup MSBuild
        uses: microsoft/setup-msbuild@v1.1
        with:
          msbuild-architecture: x64,x86

      - name: Install Windows SDK
        uses: ChristopheLav/windows-sdk-install@v1
        with:
          version-sdk: 17763
          features: 'OptionId.DesktopCPPx64,OptionId.DesktopCPPx86,OptionId.DesktopCPParm64'

      - name: Build app for release
        run: |
          msbuild VMoveCAD.sln /p:Configuration=Release /p:Platform=x64 /p:WindowsTargetPlatformVersion=10.0.17763.0 /p:UseUnicodeResponseFiles=false /p:EnableParallelBuild=true /p:MaxCpuCount=8 /p:BuildInParallel=true /p:MultiProcessorCompilation=true /p:UseDebugLibraries=false /p:TrackFileAccess=false /p:LinkIncremental=false /p:UsePDB=false /p:CreatePDB=false /p:GenerateFullPaths=false /p:PlatformToolset=v142 /p:EnableJITConcurrency=true /p:EnableMPLogging=true /p:DisableMPLogging=false /p:UseIntelMKL=true /p:FS=true
 
         
          
    
    
